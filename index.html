<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=640, user-scalable=no">
    <script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.min.js" ></script>
    <link rel="stylesheet" href="css/index.css" />
    <title>啡尝食刻 甜蜜整点</title>
</head>
<body>


<div class="m-music btn_audio" data-src="bgm.mp3">
    <img src="images/music-on.png" width="40" class="music music-on rotate" alt="">
    <img src="images/music-off.png" width="40" class="music music-off m-hidden" alt="">
</div>


<div class="pub-deil-div undis pabs">
    <img src=""/>
    <div class="ts pabs">温馨提示：<br/>为确保产品新鲜美味，请提前3天至江浙沪地区星巴克门店预约购买</div>
    <a class="close pabs" href="javascript:void(0)"></a>
</div>

<div class="ibg prel ">
    <div class="title pabs"></div>
    <a href="javascript:void(0)" class="bnt pabs undis"></a>
    <div class="loading pabs"><label></label>loading...</div>
    <div class="foot-txt pabs">温馨提示<br/>本页面介绍的整只蛋糕系列产品仅于江浙沪地区星巴克有售</div>
</div>

<div class="list-bg undis ovf prel">


    <div id="xams">

        <!--

                <div class="pub-snowflake sf01 pabs"><label></label></div>
                <div class="pub-snowflake sf02 pabs"><label></label></div>
                <div class="pub-snowflake sf03 pabs"><label></label></div>
                <div class="pub-snowflake sf04 pabs"><label></label></div>
                <div class="pub-snowflake sf05 pabs"><label></label></div>
        -->

        <div data-num="sum3-d01" class="sum3-01 pabs"></div>
        <div data-num="sum3-d01" class="sum3-txt01 pabs"></div>
        <div data-num="sum3-d02" class="sum3-02 pabs"></div>
        <div data-num="sum3-d02" class="sum3-txt02 pabs"></div>


        <div data-num="sum3-d01" class="sum3-cake01 pabs"></div>
        <div data-num="sum3-d02" class="sum3-cake02 pabs"></div>

    </div>


    <div id="common">

        <div class="d01 pabs"></div>
        <div class="d02 pabs"></div>
        <div class="d03 pabs"></div>
        <div class="d04 pabs"></div>
        <div class="d05 pabs"></div>
        <div class="d06 pabs"></div>

        <div class="m01 pabs"></div>
        <div class="m02 pabs"></div>
        <div class="m03 pabs"></div>

        <div data-num="01" class="com-cake01 pabs"></div>
        <div data-num="01" class="com-txt01 pabs"></div>


        <div data-num="02" class="com-cake02 pabs"></div>
        <div data-num="02" class="com-txt02 pabs"></div>

        <div data-num="03" class="com-cake03 pabs"></div>
        <div data-num="03" class="com-txt03 pabs"></div>


        <div data-num="04" class="com-cake04 pabs"></div>
        <div data-num="04" class="com-txt04 pabs"></div>

        <!--
                <div data-num="05" class="com-cake05 pabs"></div>
                <div data-num="05" class="com-txt05 pabs"></div>

                <div data-num="06" class="com-cake06 pabs"></div>
                <div data-num="06" class="com-txt06 pabs"></div>
        -->

        <div data-num="07" class="com-cake07 pabs"></div>
        <div data-num="07" class="com-txt07 pabs"></div>

        <div data-num="08" class="com-cake08 pabs"></div>
        <div data-num="08" class="com-txt08 pabs"></div>

        <div data-num="09" class="com-cake09 pabs"></div>
        <div data-num="09" class="com-txt09 pabs"></div>

        <div data-num="10" class="com-cake10 pabs"></div>
        <div data-num="10" class="com-txt10 pabs"></div>

        <div data-num="11" class="com-cake11 pabs"></div>
        <div data-num="11" class="com-txt11 pabs"></div>
    </div>


</div>
<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script type="text/javascript" src="js/jssdk.js"></script>
<script>

    var LoadOption ={
        Loaded:0,
        List:[
            {type:'image',path:'images/font.png'},
            {type:'image',path:'images/pai.png'},
            {type:'image',path:'images/bg.jpg'},
            {type:'image',path:'images/list-bg.jpg'},


            {type:'image',path:'images/BlueBerry-Cream-Cheese-Cake.png'},
            {type:'image',path:'images/BlueBerry-Cream-Cheese-Cake-font.png'},
            {type:'image',path:'images/Mango-Cream-Cake.png'},
            {type:'image',path:'images/Mango-Cream-Cake-font.png'},

            {type:'image',path:'images/font01.png'},
            {type:'image',path:'images/font02.png'},
            {type:'image',path:'images/font03.png'},
            {type:'image',path:'images/font04.png'},
            {type:'image',path:'images/font05.png'},
            {type:'image',path:'images/font06.png'},
            {type:'image',path:'images/font07.png'},
            {type:'image',path:'images/font08.png'},
            {type:'image',path:'images/font09.png'},
            {type:'image',path:'images/font10.png'},
            {type:'image',path:'images/font11.png'},
        ],
        Start:function(action){
            var _self = this;
            _self.Callback = action;

            $.each(this.List,function(){
                var path = this.path;
                switch(this.type){
                    case 'javascript':
                        $.getScript(this.path,function(){
                            _self.Loaded += 1;
                            console.log(path)
                            _self.Callback ((_self.Loaded / _self.List.length ) * 100);
                        })
                        break;
                    case 'image':
                        var img1 = new Image();
                        $(img1).on('load',function(){
                            _self.Loaded += 1;
                            console.log(path)
                            _self.Callback ((_self.Loaded / _self.List.length ) * 100,path);
                        });
                        img1.src = this.path;
                        break;
                    case 'other':
                        this.action(this.path,function(){
                            _self.Loaded += 1;
                            console.log(path);
                            _self.Callback ((_self.Loaded / _self.List.length ) * 100);
                        })
                        break;
                }
            });

        },
    }




    $(document).ready(function(){


        JSSDK.init('http://weixin.spcc.mobi/oauth/_jssdk.html',true,function(){

            var shareOption = {
                title: "啡尝食刻 甜蜜整点",
                desc: "温情深秋，和TA一起分享甜蜜，感受幸福滋味。",
                link: "http://ck2015.spcc.mobi/",
                imgUrl: 'http://ck2015.spcc.mobi/300_300.png',
                success: function () {
                    // 用户确认分享后执行的回调函数

                    _mwt.push(['_trackEvent', 'Friend']);

                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            };

            var shareOptionTimeline = {
                title: "温情深秋，和TA一起分享甜蜜，感受幸福滋味。",
                desc: "温情深秋，和TA一起分享甜蜜，感受幸福滋味。",
                link: "http://ck2015.spcc.mobi/",
                imgUrl: 'http://ck2015.spcc.mobi/300_300.png',
                success: function () {
                    // 用户确认分享后执行的回调函数
                    //_mwt.push(['_trackEvent', 'Timeline']);
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            };

            var shareQQFriend = {
                title: "啡尝食刻 甜蜜整点",
                desc: "温情深秋，和TA一起分享甜蜜，感受幸福滋味。",
                link: "http://ck2015.spcc.mobi/",
                imgUrl: 'http://ck2015.spcc.mobi/300_300.png',
                success: function () {
                    // 用户确认分享后执行的回调函数
                    //_mwt.push(['_trackEvent', 'qq']);
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            };


            wx.onMenuShareAppMessage(shareOption);
            wx.onMenuShareQQ(shareOption);
            //wx.onMenuShareWeibo(shareOption);
            wx.onMenuShareTimeline(shareOptionTimeline);

            //初始化播放音频
            require(['assets/js/music'], function( music){ music._audio.play();});


        });

        LoadOption.Start(function(Progress,path){
            var prss = Progress.toFixed(0);
            $('.loading label').html(''+prss+'%');

            if(Progress>=100){
                $('.loading').hide();
                $('.ibg .bnt').show();
            }
        });

        $('.ibg a').click(function(){
            $(this).parent().hide();
            $('.list-bg').show();
        });


        $(window).scroll(function (){
            var n=$(window).scrollTop();
            if(n>=000){
                $('.m01').addClass('m01-add');
            }else if(n<600 || n>1765){
                $('.m01').removeClass('m01-add');
            }

            if(n>100){
                $('.m02').addClass('m02-add');
            }else if(n<700 || n>1765){
                $('.m02').removeClass('m02-add');
            }

            if(n>250){
                $('.m03').addClass('m03-add');
            }else if(n<250 || n>1165){
                $('.m03').removeClass('m03-add');
            }

        });

        $('.list-bg').click(function(event){
            var target=event.target;
            var num=$(target).attr('data-num')

            if(num!=undefined){
                $('.pub-deil-div').show();
                $('.pub-deil-div img').attr('src','images/'+num+'.jpg')
            }
            if(num=='xmas-d01'){
                $('.pub-deil-div .close').css('bottom','120px');
            }else if(num=='xmas-d02'){
                $('.pub-deil-div .close').css('bottom','120px');
            }else if(num=='xmas-d03'){
                $('.pub-deil-div .close').css('bottom','120px');
            }else{
                $('.pub-deil-div .close').css('bottom','8%');
            }
        });

        $('.close').click(function(){
            $('.pub-deil-div').hide();
        });

    });
</script>


<!--音乐播放器-->
<script type="text/javascript" src="js/music.js"></script>
<script type="text/javascript">
    $(function(){
        /**
         * 一个崭新的开始
         */


        require(['assets/js/music'], function( music){
                // 声音初始化
                music.media_init();

                // 声音启动
                // $(document).one("touchstart", function(){
                // 播放声音
                if(!music._audio) return;
                music._audioNode.removeClass('m-hidden');
                music._audio.play();

                $('.btn_audio').on('click',music.audio_control);
                // });

            }
        );

        /**
         * 工具函数集合
         **************************************************/


        define('assets/js/music', [], function(){


            var __media = {
                _audioNode      : $('.m-music'),                        // 声音模块
                _audio          : null,                                 // 声音对象
                _audio_val      : false,                                 // 声音是否开启控制

                _videoNode      : $('.j-video'),                        // 视频DOM

                // 声音初始化
                audio_init : function(){
                    if (__media._audioNode.length <= 0) {
                        return;
                    }

                    // media资源的加载
                    var options_audio = {
                        loop: true,
                        preload: "auto",
                        autoplay: "true",
                        src: this._audioNode.attr('data-src')
                    }

                    this._audio = new Audio();

                    for(var key in options_audio){
                        if(options_audio.hasOwnProperty(key) && (key in this._audio)){
                            this._audio[key] = options_audio[key];
                        }
                    }
                    this._audio.load();
                },

                // 声音事件绑定
                audio_addEvent : function(){
                    if(this._audioNode.length<=0) return;

                    // 声音按钮点击事件
                    var txt = this._audioNode.find('.txt_audio'),
                        time_txt = null;

                    // 声音打开事件
                    $(this._audio).on('play',function(){
                        __media._audio_val = false;

                        // audio_txt(txt,true,time_txt);
                        audio_img(true)

                        // 播放事件
                        // global._handleEvent('audio_play');
                    })

                    // 声音关闭事件
                    $(this._audio).on('pause',function(){
                        __media._audio_val = true;
                        audio_img(false)
                        // audio_txt(txt,false,time_txt)

                        // 停止事件
                        // global._handleEvent('audio_pause');
                    })

                    function audio_img(val){

                        if (val) {
                            __media._audioNode.find('.music-on').removeClass('m-hidden');
                            __media._audioNode.find('.music-off').addClass('m-hidden');
                        } else {

                            __media._audioNode.find('.music-off').removeClass('m-hidden');
                            __media._audioNode.find('.music-on').addClass('m-hidden');
                        }
                    }

                },

                // 声音控制函数
                audio_control : function(){

                    if(!__media._audio_val){
                        __media.audio_stop();
                    }else{
                        __media.audio_play();
                    }
                },

                // 声音播放
                audio_play : function(){
                    __media._audio_val = false;
                    if(__media._audio) __media._audio.play();
                },

                // 声音停止
                audio_stop  : function(){
                    __media._audio_val = true;
                    if(__media._audio) __media._audio.pause();
                },

                // 视频初始化
                video_init : function(){
                    // 视频
                    this._videoNode.each(function(){
                        var option_video = {
                            controls: 'controls',
                            preload : 'none',
                            // poster : $(this).attr('data-poster'),
                            width : $(this).attr('data-width'),
                            height : $(this).attr('data-height'),
                            src : $(this).attr('data-src')
                        }

                        var video = $('<video class="f-hide"></video>')[0];
                        var img = $(this).find('.img');

                        for(var key in option_video){
                            if(option_video.hasOwnProperty(key) && (key in video)){
                                video[key] = option_video[key];
                            }
                            this.appendChild(video);
                        }

                        $(video).on('play',function(){
                            img.hide();
                            $(video).removeClass('f-hide');
                        });

                        $(video).on('pause',function(){
                            img.show();
                            $(video).addClass('f-hide');
                        });
                    })
                },

                //处理声音和动画的切换
                media_control : function(){
                    if(!this._audio) return;
                    if($('video').length<=0) return;

                    $(this._audio).on('play', function(){
                        $('video').each(function(){
                            if(!this.paused){
                                this.pause();
                            }
                        });
                    });

                    $('video').on('play', function(){
                        if(!__media._audio_val){
                            __media.audio_control();
                        }
                    });

                    $('video').on('pause', function(){
                        if(__media._audio_val){
                            __media.audio_control();
                        }
                    });
                },

                // media管理初始化
                media_init : function(){
                    // 声音初始化
                    this.audio_init();

                    // 视频初始化
                    this.video_init();

                    // 绑定音乐加载事件
                    this.audio_addEvent();

                    // 音频切换
                    this.media_control();
                }
            }

            return __media;
        })


    });</script>

</body>
</html>
